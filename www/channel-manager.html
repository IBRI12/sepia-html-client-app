<div id='sepiaFW-frame-carousel' class="sepiaFW-inner-container sepiaFW-carousel">
	<div class='sepiaFW-carousel-pane-container'>
		<!-- Page 1 -->
		<div id="sepiaFW-frame-page-1" class='sepiaFW-frames-page sepiaFW-carousel-pane'>
			<div id="sepiaFW-channel-manager-view" class="group-container">
				<div class="group column">
					<h2>Channel Manager</h2>
					<p class="info-text centered" style="margin-bottom: 0;">
						<b>Create new chat channel:</b> Choose a name (max. 26 characters), add some initial members (user IDs), add an assistant to the channel
						and make it public (anybody can join) if you like.
					</p>
				</div>
				<div class="group column">
					<h3>Channel Name:</h3>
					<input id="sepiaFW-channel-manager-cname" placeholder="My new channel">
					<br>
					<h3>Initial Members:</h3>
					<input id="sepiaFW-channel-manager-cmembers" placeholder="User-ID-1, User-ID-2, ...">
					<br><br>
					<div class="subgroup">
						<label>Is Public?</label>
						<input type="checkbox" id="sepiaFW-channel-manager-is-public">
					</div>
					<div class="subgroup">
						<label>Add assistant?</label>
						<input type="checkbox" id="sepiaFW-channel-manager-add-assist" checked>
					</div>
				</div>
				<div class="group center extra-space-tb">
					<button id="sepiaFW-channel-manager-create-btn">CREATE NEW</button>
				</div>
			</div>
		</div>
		<!-- Page 2 -->
		<div id="sepiaFW-frame-page-2" class='sepiaFW-frames-page sepiaFW-carousel-pane'>
			<div id="sepiaFW-channel-manager-view" class="group-container">
				<div class="group column">
					<h2>Channel Manager</h2>
					<p class="info-text centered" style="margin-bottom: 0;">
						<b>Join chat channel:</b> Get its ID and access key from the channel owner, enter the data and hit 'join'. 
						If the channel is public leave the key field empty.
					</p>
				</div>
				<div class="group column">
					<h3>Channel ID:</h3>
					<input id="sepiaFW-channel-manager-cid" placeholder="">
					<br>
					<h3>Channel Key:</h3>
					<input id="sepiaFW-channel-manager-ckey" type="password">
				</div>
				<div class="group center extra-space-tb">
					<button id="sepiaFW-channel-manager-join-btn">JOIN</button>
				</div>
			</div>
		</div>
		<!-- Page 3 -->
		<div id="sepiaFW-frame-page-3" class='sepiaFW-frames-page sepiaFW-carousel-pane'>
			<div id="sepiaFW-channel-manager-view" class="group-container">
				<div class="group column">
					<h2>Channel Manager</h2>
					<p class="info-text centered" style="margin-bottom: 0;">
						<b>Delete chat channel:</b> Enter its ID and hit 'delete'. Please note that you can only delete channels that you own AND
						that all members will be kicked out of the channel when you delete it!
					</p>
				</div>
				<div class="group column">
					<h3>Channel ID:</h3>
					<input id="sepiaFW-channel-manager-cid-delete" placeholder="">
				</div>
				<div class="group center extra-space-tb">
					<button id="sepiaFW-channel-manager-delete-btn" class="dangerous">DELETE</button>
				</div>
			</div>
		</div>
	</div>
</div>
<div id="sepiaFW-frames-nav-bar" class='sepiaFW-layer-header'>
	<button id="sepiaFW-frames-close" class='entry'>
		<i class="material-icons md-btn2">&#xE5CD;</i>
	</button>
	<button id="sepiaFW-frames-show-prev-page" class='entry'>
		<i class="material-icons md-btn2">keyboard_arrow_left</i><span data-localize="back">back</span>
	</button>
	<button id="sepiaFW-frames-show-next-page" class='entry'>
		<span data-localize="next">next</span><i class="material-icons md-btn2">keyboard_arrow_right</i>
	</button>
	<div id="sepiaFW-frames-nav-bar-page-indicator"><div>&nbsp;</div><div>&nbsp;</div><div>&nbsp;</div></div>
	<!--<div id="sepiaFW-frames-nav-bar-page-indicator"><div>&nbsp;</div></div>-->
</div>
<script>
	$('[data-localize]').each(function(){
		$(this).html(SepiaFW.local.g(this.dataset.localize));
	});

	//Input handling
	$('#sepiaFW-channel-manager-cname').off().on("change", function(){
		if (this.value){
			this.value = this.value.replace(/[^\w\s#-\?!\.]/gi,"").replace(/\s+/gi, " ").substring(0, 26);
		}
	});
	
	//Create channel
	$("#sepiaFW-channel-manager-create-btn").off().on("click", function(){
		//get data
		var channelData = {};
		
		var name = $('#sepiaFW-channel-manager-cname').val();
		if (!name){
			SepiaFW.ui.showPopup("Please enter a name for the new channel first.");
			return;
		}
		channelData.name = name;

		var membersString = $('#sepiaFW-channel-manager-cmembers').val();
		var members = [];
		if (membersString){
			membersString.split(",").forEach(function(m){
				m = m.trim();
				if (m.match(/^[A-Za-z]+\d+$/)){
					members.push(m);
				}else{
					SepiaFW.debug.error("Removed from members array due to invalid format: " + m);
				}
			});
		}
		channelData.members = members;
		channelData.isPublic = $('#sepiaFW-channel-manager-is-public').is(':checked');
		channelData.addAssistant = $('#sepiaFW-channel-manager-add-assist').is(':checked');

		//send request
		//console.log(JSON.stringify(channelData));
		SepiaFW.client.createChannel(channelData);
	});
</script>